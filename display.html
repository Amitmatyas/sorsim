<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>עבודת שורשים</title>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* סגנונות כלליים לגוף העמוד */
        body {
            font-family: 'Heebo', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f8f8f8;
            direction: rtl; /* כיווניות מימין לשמאל לעברית */
            line-height: 1.6; /* גובה שורה */
            color: #333; /* צבע טקסט כללי */
        }
        /* סגנונות למיכל העבודה הראשי */
        .work-container {
            max-width: 800px; /* רוחב מקסימלי */
            margin: 20px auto; /* ממורכז אופקית עם רווח עליון/תחתון */
            background-color: #fff;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); /* צל עדין */
            border-top: 5px solid #007bff; /* פס כחול עליון */
        }
        /* סגנונות לכותרת הראשית של העבודה */
        .main-title {
            text-align: center;
            color: #007bff;
            font-size: 2.8em;
            margin-bottom: 30px;
            font-weight: 700;
        }
        /* סגנונות לכותרת המשנה (שם הילד) */
        .sub-title {
            text-align: center;
            color: #555;
            font-size: 1.5em;
            margin-bottom: 40px;
            border-bottom: 1px dashed #ccc; /* קו מקווקו תחתון */
            padding-bottom: 20px;
        }
        /* סגנונות לבלוק תצוגת מקטע */
        .section-display {
            margin-bottom: 40px;
            padding: 20px;
            background-color: #fdfdfd;
            border-left: 5px solid #eee; /* פס אפור בצד שמאל */
            border-radius: 5px;
        }
        /* סגנונות לכותרת בתוך בלוק מקטע */
        .section-display h3 {
            color: #0056b3;
            font-size: 1.8em;
            margin-top: 0;
            margin-bottom: 15px;
            border-bottom: 2px solid #007bff; /* קו כחול תחתון */
            padding-bottom: 5px;
        }
        /* סגנונות לפסקאות בתוך תוכן מקטע */
        .section-content p {
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        /* סגנונות לטקסט מודגש בתוך תוכן מקטע */
        .section-content strong {
            color: #333;
        }
        /* סגנונות לרשימות (לא מסודרות ומסודרות) */
        .section-content ul, .section-content ol {
            padding-right: 20px; /* התאמה ל-RTL */
            padding-left: 0;
        }
        /* סגנונות לפריטי רשימה */
        .section-content li {
            margin-bottom: 5px;
        }
        /* סגנונות לתיבת הודעות מותאמת אישית */
        .message-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            text-align: center;
            display: none; /* מוסתר כברירת מחדל */
        }
        /* סגנונות לכפתור בתיבת ההודעות */
        .message-box button {
            margin-top: 15px;
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
    </style>
    <!-- Firebase SDKs - ייבוא ספריות Firebase -->
    <script type="module">
        // הגדרות Firebase של האפליקציה שלך
        const firebaseConfig = {
            apiKey: "AIzaSyDlyDbpwcBcWvFnvYHb84dMEpaQFTjv-HY",
            authDomain: "tester-69fa9.firebaseapp.com",
            projectId: "tester-69fa9",
            storageBucket: "tester-69fa9.firebasestorage.app",
            messagingSenderId: "378563229004",
            appId: "1:378563229004:web:5136b724eb84fd00e44be9",
            measurementId: "G-BFJ1QQM3MS"
        };
        
        // ייבוא פונקציות ספציפיות מ-Firebase SDK
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        // אתחול Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app); // קבלת מופע של Firestore

        // פונקציה להצגת תיבת הודעה מותאמת אישית
        function showMessage(message, callback = null) {
            const messageBox = document.getElementById('messageBox');
            const messageText = document.getElementById('messageText');
            const messageButton = document.getElementById('messageButton');

            messageText.textContent = message;
            messageBox.style.display = 'block';

            messageButton.onclick = function() {
                messageBox.style.display = 'none';
                if (callback) {
                    callback();
                }
            };
        }

        // פונקציה המופעלת כאשר המסמך נטען במלואו
        document.addEventListener('DOMContentLoaded', async function() {
            // חילוץ מזהה הילד מה-URL (לדוגמה: /Amit-Matyas -> childEnglishId = "Amit-Matyas")
            const pathSegments = window.location.pathname.split('/').filter(segment => segment);
            let childEnglishId = '';
            if (pathSegments.length > 0) {
                childEnglishId = pathSegments[pathSegments.length - 1]; // המקטע האחרון הוא המזהה
            }

            // אם לא נמצא מזהה ילד, הצג הודעה והפנה לעמוד היצירה הראשי
            if (!childEnglishId) {
                showMessage('שגיאה: לא נמצא מזהה ילד בכתובת ה-URL. אנא וודא שהכתובת נכונה.', function() {
                    window.location.href = '/'; // חזרה ל-index.html הראשי
                });
                return;
            }

            try {
                const docRef = doc(db, "works", childEnglishId); // הפניה למסמך הספציפי
                const docSnap = await getDoc(docRef); // קבלת תמונת מצב של המסמך

                if (docSnap.exists()) { // אם המסמך קיים
                    const data = docSnap.data(); // קבלת הנתונים מהמסמך
                    const mainTitleElement = document.getElementById('mainTitle');
                    const subTitleElement = document.getElementById('subTitle');
                    const sectionsContainer = document.getElementById('sectionsContainer');

                    mainTitleElement.textContent = `עבודת שורשים`; // הגדרת כותרת ראשית
                    subTitleElement.textContent = `${data.childFirstNameHebrew || ''} ${data.childLastNameHebrew || ''}`.trim(); // הגדרת כותרת משנה (שם הילד בעברית)

                    // הצגת המקטעים אם קיימים
                    if (data.sections && Array.isArray(data.sections)) {
                        data.sections.forEach(section => {
                            const sectionDiv = document.createElement('div');
                            sectionDiv.className = 'section-display'; // קלאס לתצוגת מקטע
                            let contentHtml = '';
                            
                            // בניית תוכן המקטע לפי הסוג
                            switch (section.type) {
                                case 'firstName':
                                    contentHtml = `
                                        <h3>שם פרטי</h3>
                                        <div class="section-content">
                                            <p><strong>כינוי:</strong> ${section.data.nickname || 'לא הוזן'}</p>
                                            <p><strong>מקור השם:</strong> ${section.data.nameOrigin || 'לא הוזן'}</p>
                                            <p><strong>סיפור מאחורי השם:</strong></p>
                                            <p>${section.data.nameStory || 'לא הוזן'}</p>
                                        </div>
                                    `;
                                    break;
                                case 'lastName':
                                    contentHtml = `
                                        <h3>שם משפחה</h3>
                                        <div class="section-content">
                                            <p><strong>משמעות השם:</strong> ${section.data.lastNameMeaning || 'לא הוזן'}</p>
                                            <p><strong>מוצא המשפחה:</strong> ${section.data.familyOrigin || 'לא הוזן'}</p>
                                            <p><strong>תולדות המשפחה:</strong></p>
                                            <p>${section.data.familyHistory || 'לא הוזן'}</p>
                                        </div>
                                    `;
                                    break;
                                case 'letterFromPast':
                                    contentHtml = `
                                        <h3>מכתב מהעבר</h3>
                                        <div class="section-content">
                                            <p><strong>מאת:</strong> ${section.data.letterFrom || 'לא הוזן'}</p>
                                            <p><strong>אל:</strong> ${section.data.letterTo || 'לא הוזן'}</p>
                                            <p><strong>תוכן המכתב:</strong></p>
                                            <p>${section.data.letterContent || 'לא הוזן'}</p>
                                        </div>
                                    `;
                                    break;
                                case 'familyID':
                                    contentHtml = `
                                        <h3>ת"ז משפחתית</h3>
                                        <div class="section-content">
                                            <p><strong>שם מלא:</strong> ${section.data.fullName || 'לא הוזן'}</p>
                                            <p><strong>תאריך לידה:</strong> ${section.data.dob || 'לא הוזן'}</p>
                                            <p><strong>מקום לידה:</strong> ${section.data.placeOfBirth || 'לא הוזן'}</p>
                                            <p><strong>עיסוק:</strong> ${section.data.occupation || 'לא הוזן'}</p>
                                        </div>
                                    `;
                                    break;
                                case 'interview':
                                    contentHtml = `
                                        <h3>ראיון</h3>
                                        <div class="section-content">
                                            <p><strong>שם המרואיין:</strong> ${section.data.intervieweeName || 'לא הוזן'}</p>
                                            <p><strong>קשר משפחתי:</strong> ${section.data.relationship || 'לא הוזן'}</p>
                                            <p><strong>תוכן הראיון:</strong></p>
                                            <p>${section.data.interviewContent || 'לא הוזן'}</p>
                                        </div>
                                    `;
                                    break;
                                case 'custom':
                                    contentHtml = `
                                        <h3>${section.data.customTitle || 'מקטע מותאם אישית'}</h3>
                                        <div class="section-content">
                                            ${section.data.customContent || 'אין תוכן למקטע זה.'}
                                        </div>
                                    `;
                                    break;
                                default:
                                    contentHtml = `<p>סוג מקטע לא ידוע.</p>`;
                            }
                            sectionDiv.innerHTML = contentHtml;
                            sectionsContainer.appendChild(sectionDiv);
                        });
                    } else {
                        sectionsContainer.innerHTML = '<p style="text-align: center; color: #777;">טרם נוספו מקטעים לעבודה זו.</p>';
                    }
                } else { // אם המסמך לא קיים
                    showMessage(`שגיאה: עבודה עם מזהה "${childEnglishId}" לא נמצאה. ייתכן שהיא נמחקה או שהכתובת שגויה.`, function() {
                        window.location.href = '/'; // חזרה ל-index.html הראשי
                    });
                }
            } catch (e) { // טיפול בשגיאות טעינה
                console.error("Error loading document: ", e);
                showMessage('שגיאה בטעינת העבודה. אנא נסה שוב מאוחר יותר.', function() {
                    window.location.href = '/'; // חזרה ל-index.html הראשי
                });
            }
        });
    </script>
</head>
<body>
    <div class="work-container">
        <h1 id="mainTitle"></h1>
        <h2 id="subTitle"></h2>
        <div id="sectionsContainer">
            <!-- מקטעים יוצגו כאן באופן דינמי -->
        </div>
    </div>

    <!-- תיבת הודעות מותאמת אישית -->
    <div id="messageBox" class="message-box">
        <p id="messageText"></p>
        <button id="messageButton">אישור</button>
    </div>
</body>
</html>
